
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yemek Sepeti - Dönerler</title>
  <link rel="stylesheet" href="bootstrap.css">
  <link rel="icon" type="image/png" href="Logo.png">
  <style>
    body{
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      background-color: rgb(151, 151, 151);
    }
    .navbar-beyaz {background-color:white; height: 110px;}
    .navbar-nav .nav-link {
      color:#000000;
      margin:0 8px;
      font-weight:500;
    }
    .ürün-kart {
      border:none;
      overflow:hidden;
      transition: transform 0.4s ease, box-shadow 0.4s ease;
      cursor:pointer;
    }
    .ürün-kart img {
      transition: transform 0.5s ease;
      width: 100%;
      height: 300px;
      object-fit: cover;
    }
    .ürün-kart:hover {
      transform: translateY(-6px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    .ürün-kart:hover img {transform: scale(1.08);}
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-beyaz slide-down" id="animatedNav">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="#">
      <img onclick="anasayfa()" src="Logo.png" alt="Bilgem Rent A Car" height="50" class="me-2">
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav mx-auto">
        <li class="nav-item"><a class="nav-link" href="index.html">ANASAYFA</a></li>
        <li class="nav-item"><a class="nav-link" style="margin-left:600px; background-color:white;" href="sepetim.html"><img src="shopping-bag.svg" alt=""><span>Sepetim</span></a></li>
      </ul>
    </div>
  </div>
</nav>

<section class="py-5">
  <div class="container text-center">


    <div class="row g-4" id="donerKartlari"></div>

    <div id="menuContainer" style="display:none;" class="mt-5"></div>

  </div>
</section>

<script src="bootstrap.bundle.js"></script>
<script>
const API_BASE = "http://localhost:5000/api"; 

function anasayfa(){ window.location.href="index.html"; }

async function anaSayfaUrunleriGetir() {
  try {
    const res = await fetch(`${API_BASE}/products`);
    const products = await res.json();
    const container = document.getElementById("donerKartlari");
    container.innerHTML = "";

    products.forEach(p => {
      const col = document.createElement("div");
      col.className = "col-md-3 col-sm-6 ürün-kutu";
      col.innerHTML = `
        <div class="card ürün-kart" onclick="urunDetayAc('${p.slug}')">
          <img src="${p.resim}" class="card-img-top" alt="${p.ad}">
          <div class="card-body">
            <h6 class="card-title"><img style="width:30px;height:30px;" src="${p.logo}"> ${p.ad}</h6>
            <p style="font-size:10px;">Minimum ${p.minSiparis}₺ ${p.hizliTeslim ? '<img style="width:15px;height:15px;" src="motorbike.png">' : ''}</p>
          </div>
        </div>
      `;
      container.appendChild(col);
    });
  } catch (err) {
    console.error("Ürünler alınamadı:", err);
  }
}


async function urunDetayAc(slug){
  document.getElementById("donerKartlari").style.display = "none";
  const menuContainer = document.getElementById("menuContainer");
  menuContainer.style.display = "block";

  try {
    const res = await fetch(`${API_BASE}/products/${slug}/menus`);
    const menus = await res.json();

    let html = `<h3 class="mb-4">${slug.toUpperCase()} Menüleri</h3><div class="row">`;
    menus.forEach(m => {
      html += `
        <div class="col-md-4">
          <div class="card mb-4">
            <img src="${m.resim}" class="card-img-top" alt="${m.ad}">
            <div class="card-body">
              <h5 class="card-title">${m.ad}</h5>
              <p class="card-text">${m.aciklama}</p>
              <p><strong>${m.fiyat}₺</strong></p>
              <button class="btn btn-success" onclick="sepeteEkle('${m.ad}',${m.fiyat})">Sipariş Ver</button>
            </div>
          </div>
        </div>
      `;
    });
    html += `</div><button class="btn btn-secondary mt-3" onclick="geriDon()">← Geri</button>`;
    menuContainer.innerHTML = html;

  } catch(err){
    console.error("Menüler alınamadı:", err);
  }
}


function geriDon(){
  document.getElementById("menuContainer").style.display="none";
  document.getElementById("donerKartlari").style.display="flex";
}

async function sepeteEkle(urun, fiyat){
  try {
    const res = await fetch(`${API_BASE}/cart`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ urunAdi: urun, fiyat: fiyat, miktar: 1 })
    });
    const data = await res.json();
    if(res.ok){
      alert(`${urun} sepete eklendi!`);
    } else {
      alert("Sepete eklenemedi: " + data.message);
    }
  } catch(err){
    console.error(err);
    alert("Sepete eklerken hata oluştu.");
  }
}

anaSayfaUrunleriGetir();
</script>

</body>
</html>
